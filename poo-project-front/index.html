<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <title>
        Cadastro de Clientes Manager Cell 
    </title>
</head>

<body>
    <div class="row">
        <div class="col-sm-offset-1 col-sm-12">
            <form id="cadastro-smartphone" class="text-center border border-light p-5" action="#!">

                <p class="h4 mb-4">Bem-vindo ao Sistema de Triagem de Clientes da Manager Cell !</p>
                <p class="h4 mb-4">Cadastre um Novo Cliente:</p>

                <input type="text" id="nome" class="offset-3 col-sm-6 form-control mb-4" placeholder="Nome do Cliente">
                <input type="text" id="cpf" class="offset-3 col-sm-6 form-control mb-4"
                    placeholder="CPF do Cliente (Somente Números)" onblur="TestaCPF(this.value);">
                <input type="text" id="marca" class="offset-3 col-sm-6 form-control mb-4"
                    placeholder="Marca do Produto">
                <input type="text" id="modelo" class="offset-3 col-sm-6 form-control mb-4"
                    placeholder="Modelo do Produto">
                <input type="text" id="problema" class="offset-3 col-sm-6 form-control mb-4"
                    placeholder="Problema do Produto">
                <button class="btn btn-info btn-block my-3 offset-3 col-sm-6" type="submit">Cadastrar</button>
            </form>
        </div>
    </div>
    <input type="text" id="myInput" class="offset-3 col-sm-6 form-control mb-4" onkeyup="myFunction()"
        placeholder="Digite o ID do cliente que deseja buscar...">
    <div class="row">
        <div class="offset-2 col-sm-8">
            <table id="grid" class="table table-bordered">
                <thead>
                    <tr>
                        <th colspan="6" class="text-center">Clientes Cadastrados</th>

                    </tr>
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>CPF</th>
                        <th>Marca</th>
                        <th>Modelo</th>
                        <th>Problema Apresentado</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="6">Não Há Dispositivos Cadastrados</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <script src="js/jquery-3.4.1.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            ListarSmartphones();

            $("#cadastro-smartphone").submit(function (e) {
                e.preventDefault();

                var params = {
                    Nome: $('#nome').val(),
                    CPF: $('#cpf').val(),
                    Marca: $('#marca').val(),
                    Modelo: $('#modelo').val(),
                    Problema: $('#problema').val(),
                };

                $.ajax({
                    type: "POST",
                    url: "https://pooproject20191212033413.azurewebsites.net/api/SistemaCadastro/CadastrarSmartphones",
                    data: JSON.stringify(params),
                    dataType: "json",
                    contentType: "application/json",
                    success: function (retorno) {
                        CarregarLista(retorno);
                    },
                });
            });
        });


        function CarregarLista(lista) {
            $('#grid > tbody').empty();

            for (var i = 1; i < lista.length; i++) {

                var html = "<tr>" +
                    "<td>" + lista[i].id + "</td>" +
                    "<td>" + lista[i].nome + "</td>" +
                    "<td>" + lista[i].cpf + "</td>" +
                    "<td>" + lista[i].marca + "</td>" +
                    "<td>" + lista[i].modelo + "</td>" +
                    "<td>" + lista[i].problema + "</td>" +
                    "</tr>"

                $('#grid > tbody').append(html);
            }
        }

        function ListarSmartphones() {
            $.ajax({
                type: "GET",
                url: "https://pooproject20191212033413.azurewebsites.net/api/SistemaCadastro/ListarSmartphones",
                dataType: "application/JSON",
                success: function (retorno) {
                    CarregarLista(retorno);
                },
            });
        }
        
    </script>
    <script src="js/funcoes.js" type="text/javascript"></script>
</body>

</html>